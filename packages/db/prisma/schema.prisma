datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Organization {
  id          Int          @id @default(autoincrement())
  projects    Project[]    @relation
  owner_id     Int
  owner       User         @relation(name: "owner", fields: [owner_id], references: [id])
  users       User[]       @relation(name: "user")
  permissions Permission[]
  created_at   DateTime     @default(now())
  updated_at   DateTime     @updatedAt
}

model User {
  id             Int           @id @default(autoincrement())
  email          String        @unique
  organization_id Int
  organization   Organization  @relation("user", fields: [organization_id], references: [id])
  is_owner        Organization? @relation(name: "owner")
  permissions    Permission[]
  created_at      DateTime      @default(now())
  updated_at      DateTime      @updatedAt
}

model Project {
  id            Int          @id @default(autoincrement())
  api_key        String       @unique
  name          String
  owner_id       Int
  owner        Organization @relation(fields: [owner_id], references: [id])
  default_locale String
  locales       String
  text_keys      Key[]
  permissions   Permission[]
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
}

model Permission {
  organization_id Int
  organization   Organization @relation(fields: [organization_id], references: [id])
  project_id      Int
  project        Project      @relation(fields: [project_id], references: [id])
  user_id         Int
  user           User         @relation(fields: [user_id], references: [id])
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt

  @@id([organization_id, project_id, user_id])
}

model Key {
  id           Int           @id @default(autoincrement())
  project_id    Int
  project      Project       @relation(fields: [project_id], references: [id])
  key          String
  locale       String
  translations Translation[]
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
}

model Translation {
  id             Int      @id @default(autoincrement())
  key_id          Int
  key            Key      @relation(fields: [key_id], references: [id])
  locale         String
  translated_text String?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}
