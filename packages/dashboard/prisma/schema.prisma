// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//todo create org model for ownership of projects (like supabase. move po to org)
model Organization {
  id          Int          @id @default(autoincrement())
  projects    Project[]    @relation
  ownerId     Int
  owner       User         @relation(name: "owner", fields: [ownerId], references: [id])
  users       User[]       @relation(name: "user")
  permissions Permission[]
  createdAt   DateTime     @default(now())
}

model User {
  id             Int           @id @default(autoincrement())
  email          String        @unique
  organizationId Int
  organization   Organization  @relation("user", fields: [organizationId], references: [id])
  isOwner        Organization? @relation(name: "owner")
  permissions    Permission[]
  createdAt      DateTime      @default(now())
}

model Project {
  id            Int          @id @default(autoincrement())
  apiKey        String       @unique
  name          String
  ownerId       Int
  owner         Organization @relation(fields: [ownerId], references: [id])
  defaultLocale String
  locales       String
  textKeys      Key[]
  permissions   Permission[]
  createdAt     DateTime     @default(now())
}

model Permission {
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])
  projectId      Int
  project        Project      @relation(fields: [projectId], references: [id])
  userId         Int
  user           User         @relation(fields: [userId], references: [id])
  createdAt      DateTime     @default(now())

  @@id([organizationId, projectId, userId])
}

model Key {
  id           Int           @id @default(autoincrement())
  projectId    Int
  project      Project       @relation(fields: [projectId], references: [id])
  key          String
  locale       String
  translations Translation[]
}

model Translation {
  id             Int      @id @default(autoincrement())
  keyId          Int
  key            Key      @relation(fields: [keyId], references: [id])
  locale         String
  translatedText String?
  createdAt      DateTime @default(now())
}
